1152    "CONV_CHANNELS"             !
16      "VISUAL_HEAD_NUM"           !           
72      "VISUAL_HEAD_LEN"           !

4900    "VISUAL_POS_NUM"            !

4304    "VISUAL_MLP_INTERNAL"       !
14      "CONV_KERNEL_SIZE"          !

%def visual_create_weights
    "CONV_CHANNELS" @ 3 14 14 4 "G_DEVICE" @ "f16" op.create "v.embeddings.patch_embedding.weight" !
    "CONV_CHANNELS" @ 1 "G_DEVICE" @ "f16" op.create "v.embeddings.patch_embedding.bias" !
    
    "CONV_CHANNELS" @ "VISUAL_POS_NUM" @ 2 "G_DEVICE" @ "f16" op.create "v.embeddings.position_embedding.weight" !
    

%end

%def visual_load_one
    dup "Loading... " swap | ?

    dup @ swap "G_PATH" @ swap | ".fp16" | io.load
%end

%def visual_load_weights
    "v.embeddings.patch_embedding.weight"       visual_load_one
    "v.embeddings.patch_embedding.bias"         visual_load_one
    "v.embeddings.position_embedding.weight"    visual_load_one
%end

%def visual_init
    visual_create_weights
    visual_load_weights

    ; working memroy in device
    1 3 14 14336 4 "G_DEVICE" @ "f16" op.create "v_img" !
    1 "CONV_CHANNELS" @ 1 1024 4 "G_DEVICE" @ "f16" op.create "v_imgx" !
 
%end

%def visual_main
    ;;"v_img" @ app.fill
   
    "v_img" @ "./demo.fp16" io.load

    "v_img" @ io.dump 
    
    ;; conv2d
    {
        "v_img" @ 
        "v.embeddings.patch_embedding.weight" @ 
        "v.embeddings.patch_embedding.bias" @ 
        "v_imgx" @ 14 0 op.conv2d
    }

    "v_imgx" @ io.dump 
%end

